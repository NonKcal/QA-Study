name: QA Automation Pipeline

# 트리거: main 브랜치에 코드가 push 되면 실행
on:
  push:
    branches: [ "main" ]

jobs:
  test:
    runs-on: ubuntu-latest  # 리눅스 서버 대여

    steps:
    # 1. 내 코드 내려받기
    - uses: actions/checkout@v4

    # 2. 파이썬 설치
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    # 3. 라이브러리 설치 (requirements.txt 이용)
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        playwright install chromium  # 브라우저 설치

    # 4. [통합됨] 토큰 파일 생성 및 테스트 실행
    # (이 단계에서 파일 생성과 실행을 한 번에 처리합니다)
    - name: Run QA Test & Notify
      env:
        ACCESS_TOKEN: ${{ secrets.KAKAO_ACCESS_TOKEN }}
        REFRESH_TOKEN: ${{ secrets.KAKAO_REFRESH_TOKEN }}
        KAKAO_REST_API_KEY: ${{ secrets.KAKAO_REST_API_KEY }}
      run: |
        # 1. GitHub Secrets를 조합해 kakao_token.json 파일 생성
        echo "{\"access_token\": \"$ACCESS_TOKEN\", \"refresh_token\": \"$REFRESH_TOKEN\"}" > kakao_token.json
        
        # 2. 파이썬 스크립트 실행
        python kakao_map.py

    # 5. (선택) 에러 스크린샷 업로드 (실패 시에만)
    - name: Upload Error Screenshot
      if: failure()
      uses: actions/upload-artifact@v4
      with:
        name: error-screenshot
        path: error_capture.png

        #테스트용 123